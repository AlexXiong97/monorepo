<button id="send-message">Send message</button>
<script src="https://unpkg.com/eventemitter3@latest/umd/eventemitter3.min.js"></script>
<script src="scripts/mini-cf.js"></script>
<script>
  // NO SOCKETS HERE!
  (async () => {
    const nodeProvider = new NodeProvider();
    await nodeProvider.connect();

    const client = new cf.Client(nodeProvider);

    // TODO: proposeInstalL/rejectInstall require special handling that
    // can occur while the other party's dApp is closed. Who's responsible
    // for these events?

    // client.on('proposeInstall', (data) => {
      // console.log('proposeInstall');
    // });
    // client.on('install', function () {});
    // client.on('rejectInstall', function (data) {
      // nodeProvider.emit('rejectedInstall', { peerAddress: data.fromAddress });
    // });

    const appFactory = client.createAppFactory({
      // AppDefinition goes here...
      name: 'My dApp',
      url: 'dapp.html',
    });

    // Wallet broadcasts through the Node, tells the world
    // "HEY! someone's installing something", via Firebase.
    // It should fall under Hub's responsability.

    // When we send proposeInstall, we talk to the Hub.
    // The Hub will route the message for us.

    var ui = {
      sendMessage: document.getElementById('send-message')
    };

    ui.sendMessage.addEventListener('click', function () {
      nodeProvider.emit('requestPlayer');
      nodeProvider.once('matchedPlayer', (event) => {
        appFactory.proposeInstall(event.data.peerAddress, {
          // Terms goes here...
        });
      });
    });
  })();
</script>
